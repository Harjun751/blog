<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" />

        <title>üë®‚Äçüíª | Rss Part 2</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Archivo&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/blog/assets/css/styles.css">
    </head>

    <body>
        <nav>
    <a href="/blog/"><header>HARVINDER ARJUN SINGH</header></a>
    <a class="link" href="/blog/about">about</a>
</nav>
        <article class="blog-post">
    <h1 id="rss-part-2-electric-boogaloo">RSS PART 2: electric boogaloo</h1>
<p>I want to stop using dioxus for my frontend. Every stupid roadblock I meet, I have the urge to drown my laptop in a tub of soapy water. I hear whispers sometimes: ‚Äúre-write the frontend in Vue‚Ä¶ it wouldn‚Äôt take that long‚Ä¶ you‚Äôd be more <em>agile</em>‚Ä¶‚Äù. I evaluate. I think. I ruminate. Sunken cost fallacy gets the best of me and I dismiss the thoughts. I‚Äôm getting <em>really</em> close though. Let me describe the issue that has gotten me here.</p>

<h2 id="the-issue">The issue</h2>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/requests.png" />
    <figcaption>Something's probably going wrong if you have 1642 requests.</figcaption>
</figure>
<p>I was making some really nice progress on the app - I enabled PWA functionality, worked through another page that I wanted, and more. I‚Äôm not too sure what triggered this specifically, but my pages would stop loading during development. Dioxus was telling me that the reason this was happening was that I had hooks that were in conditionals - this was an issue that I was aware about, but dismissed because it was working on my end anyway. At the time. So I refactored the code to remove the hooks from the conditionals, and this is where it all falls apart.</p>

<p>I had two use_future hooks - these would take an async piece of code, run it, and allow you to get the value to render. These hooks can take in <em>dependencies</em>. When these dependencies change, the future is reloaded to get a new value. The dependencies are defined in the second argument.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let channel_future = use_future(cx, (), |_| get_channels(uid));
let cid = use_state(cx, || 1);
let post_future = use_future(cx, cid, |cid| get_daily_feed(*cid));
</code></pre></div></div>

<p>So, I had these 2 futures - channel_future has no dependencies, and post_future has a dependency on CID. Once channel_future completes, the CID is updated with the first channel in the result. This causes post_future to update, because it‚Äôs dependency changes. All good. However, for some reason, when post_future reloads, channel_future reloads as well - resulting in the code in <code class="language-plaintext highlighter-rouge">complete</code> state of channel_future to run again. WHICH means that CID is set AGAIN, <em>WHICH</em> means post_future reloads, WHICH means the code in the <code class="language-plaintext highlighter-rouge">complete</code> state of channel_future runs again, <em>WHICH</em> means, <strong>WHICH</strong> means, <em><strong>WHICH</strong></em> means, et cetera, ad inifinitum. Infinite loop. The problem was that channel_future was reloading when it wasn‚Äôt told to or set to.</p>

<h2 id="i-sleep">I sleep</h2>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/sleep.png" style="width:50%" />
</figure>
<p>I slept on it. I didn‚Äôt know why this wasn‚Äôt working, but enough is enough. I don‚Äôt want to wade through insufficient documentation again, or make a new issue on github to find out why this is happening. Below are all the reasons why I‚Äôm done with dioxus.</p>
<ul>
  <li>Issues like I just described, side-tracking me for hours</li>
  <li>Dioxus targets WASM. Requests, the premier http requests crate on Rust, does not support WASM for their Cookie Jar. This effectively means I can‚Äôt easily implement Cookies (There are other much smaller crates that target this, though.)</li>
  <li>Dioxus‚Äô ‚ÄúDeclarative Styling‚Äù doesn‚Äôt really work for me - I feel that it facilitates messy, messy styles.</li>
  <li>It‚Äôs not you, it‚Äôs me.</li>
  <li>It‚Äôs just that feeling that I could be accomplishing all that I‚Äôve done much, much faster using other frameworks</li>
</ul>

<p>So, I‚Äôm re-writing the frontend. We‚Äôre breaking up.</p>

<h2 id="back-home-or-how-i-learned-to-stop-worrying-and-love-vue">Back home, or: How I learned to stop worrying and love vue</h2>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/weenie.webp" />
    <figcaption>it's ok to accept defeat sometimes</figcaption>
</figure>
<p>I‚Äôm back to Vue. It‚Äôs my Weenie Hut Jr - but hey the whole point of the episode was that Spongebob doesn‚Äôt need to ‚Äúprove‚Äù himself or gain approval. Spongebob <em>enjoys</em> Weenie Hut Jr, and it‚Äôs not a problem to admit that! He has nothing to prove. Yes.</p>

<p>But I digress. I was able to re-write the frontend and have a 1-to-1 Vue version in less than a day (<em>and</em> it was a pretty busy day, too). Not too long after, I was working. I was producing <em>new</em> code. I was being <strong>PRODUCTIVE</strong>. I wasn‚Äôt <strong>FIGHTING</strong> the framework. Why did I ever leave you?</p>

<h2 id="creating-a-local-store-for-user-preferences">Creating a local store for user preferences</h2>
<p>My next step was to have a persistent store for user preferences somewhere. I didn‚Äôt want to use a database, and cookies seemed like an inappropriate tool to store complex objects in (i‚Äôm sure it‚Äôs viable). I then found IndexedDB, which seemed pretty appropriate. I worked through the very dry but very enriching <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Using_IndexedDB">MDN IndexedDB guide</a>, and was able to implement what I wanted to do. The API is kind of odd due to it‚Äôs asynchronous approach, and returning a value from the database transaction required me to wrap the calls in a Promise. There‚Äôs a library that wraps the API in Promises which makes it wayy more intuitive to use. Fun that I find that out <em>after</em> I finish writing the code. yay.</p>

<h2 id="giving-some-love-to-the-logger">Giving some love to the logger</h2>
<figure>
    <img class="blog-img" style="width:70%" src="/blog/assets/blog-images/2024-pending/json.jpg" />
    <figcaption>quirky dinglekasfsakdflksafjsaldf</figcaption>
</figure>
<p>At that point, all the initial features that I wanted to have in the reader was done. The last thing on my list was to properly finish the logger. The logger at the time was simply spewing out some information that could be useful into a text file - it wasn‚Äôt very readable and indexable, which was a clear problem. I thought of using some other file type/markup language to store the logs in. In my mind I had no doubt that JSON would be my way to go, but when I started implementing it I had 2 problems. Firstly, when adding a new log I was unsure what to do to maintain proper JSON syntax. For the log to be a proper object, it would have to be encapsulated with <code class="language-plaintext highlighter-rouge">[]</code>. This could not be done easily, because I was simply appending some text to the end of a file. So, my options to make this work are:</p>
<ul>
  <li>Read the file to a certain point - stop directly after a <code class="language-plaintext highlighter-rouge">[</code> or directly before a <code class="language-plaintext highlighter-rouge">]</code>. Then, append the text of the log and add back the square bracket, while making sure I have no trailing commas</li>
  <li>Read the entire file into a JSON list object, append my item to the object, run a .to_string() on it and overwrite the whole file (ok but why would I)</li>
</ul>

<p>Any option would require me to manipulate/read the file more than I want to - I‚Äôd preferrably have a solution where I can simply keep appending text without worry of an ending delimiter. Secondly, I had trouble cramming a backtrace full of newlines and formatting into a JSON field - JSON doesn‚Äôt allow multiline strings.</p>

<figure>
    <img class="blog-img" style="width:70%" src="/blog/assets/blog-images/2024-pending/yaml.jpg" />
    <figcaption>yooo isn't yaml like THE BEST one out there</figcaption>
</figure>
<p>Then, I had a thought - I could use a more ‚Äúloose‚Äù (for lack of better word) markup language that would not require me to add some ending delimiter AND would have support for multiline strings. I settled on YAML, but came into another problem. YAML was <em>almost</em> what I needed, but there was an issue regarding multiline strings - they‚Äôre supported, but there are certain patterns that are explicitly not allowed. Namely, a colon(:) followed by a space ( ). This was a pretty big problem because the backtrace was FULL of such patterns. Formatting the backtrace and manually escaping them was not an option due to the added overhead.</p>

<p>So, back to the drawing board. Another language that would allow me to express all I needed - that allowed multiline strings with no strings attached - a language that was simple enough. I know, I‚Äôll make my own language!</p>

<figure>
    <img class="blog-img" src="https://imgs.xkcd.com/comics/standards.png" />
    <figcaption>I'll do it right this time.</figcaption>
</figure>

<p>Just kidding. The answer was in front of my eyes the whole time. XML. X (eXtreme) M (maximalistic) L (Language), baby. I‚Äôve been working with it the whole time in RSS feeds and I hadn‚Äôt realised it‚Äôs <em>utility</em>. It‚Äôs <em>flexibility</em>. It‚Äôs <em>simplicity</em> ü§å. XML‚Äôs syntax needs no introduction, and it supports mulitiline text with no need for escape characters using the CDATA attribute. Perfect. Added bonus: I could now serve the log file through the API on the web, and have it be human-readable. Perrrfect.</p>
<figure>
    <img class="blog-img" style="width:70%" src="/blog/assets/blog-images/2024-pending/xml.jpg" />
    <figcaption>yooo isn't yaml like THE BEST one out there</figcaption>
</figure>
<p>Buut not really perfect. That first problem I described with JSON, where I needed an ending delimiter, was still present in XML. XML requires a root node, so it means that everything needs to be encapsulated in this root node. But, at this point I was too tired to fight, and the pros of xml outweighed this con. I‚Äôm sure I‚Äôll come up with a solution I like more soon.</p>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/logs.png" />
    <figcaption>my beautiful xml logs</figcaption>
</figure>

<h2 id="dockerizing">Dockerizing</h2>
<p>I always hate this, it feels like a chore. I started work on getting the project ready for deployment, and I wanted it Dockerized so that I could run it anywhere easily. Created the Dockerfiles, which then took an annoyingly long time build - the unoptimized backend api image was <strong>6 (six)</strong> gigabytes, and took more than 5 minutes to build on my poor T495 ThinkPad. I was fixing the CORS configuration which was very fun because each time I wanted to set a new allow-origin value, it meant that I had to wait 5 minutes to see if it worked (I was unsure on which was the origin - the IP address of the app running INSIDE the container, or the address from which I was accessing it on the OUTSIDE. Turns out it was the outside.) AND THEN once I got CORS to work on the single-stage-6GB build, when I tried a multi-stage build to decrease the size of the final image, <strong>I GOT CORS ISSUES AGAIN!!!</strong> Skill issue. Well as it turned out I <em>thought</em> I had CORS issues again but it turns out that the container exited due to an issue, and if the fronted makes a cross domain request when the receiver is down, it shows a <code class="language-plaintext highlighter-rouge">Cors issue status null</code>. That false alarm side tracked me a little, because I had no indication from the docker-cli that the container exited. Oh well. yada yada got it to work yay!!! Overall, I can say that this experience was as pleasurable as falling down a flight of stairs.</p>

<h2 id="choosing-a-name-and-a-logo">choosing a name and a logo</h2>
<p>I finally picked a name for this app while Dockerizing everything. A very good name. Are you ready? Get ready. I don‚Äôt think you‚Äôre ready.</p>

<p><strong>NewsPaper</strong></p>

<p>Wow. Let that sink in for a moment. Just, wow. I chose this name because that‚Äôs essentially what I wanted this app to be - a one-stop place to get all of my news for the day. No fancy pantsy stuff, just black-on-grey text. Maybe an image or two. It‚Äôs a great name. Simple, descriptive, and even with a mysterious arbitrary captial letter (always A plus).</p>

<p>Ok but if you‚Äôre blown away by the name, wait till you see the logo. Ok, you can see it now.</p>
<figure>
    <img class="blog-img" style="width:70%" src="/blog/assets/blog-images/2024-pending/logo.png" />
    <figcaption>some wonder how i'm such a multi-talented person</figcaption>
</figure>

<h2 id="cicd-ing-it">CI/CD-ing it</h2>
<p>This was really important! I would need a CI/CD pipeline because I expect to update the reader here and there with new scraping instructions for new websites. I was going to be deploying it to my home NAS, because I don‚Äôt want to pay for hosting or deal with any subscriptions/services. So that meant that I couldn‚Äôt simply use some github action workflow to deploy, I sure as hell wasn‚Äôt going to be exposing my IP address like that. So what were my options? Off the top of my head,
TODO: Make this a table or something</p>
<ul>
  <li>Setup a git server on my home NAS. Add the server as an origin so that when I push, the code updates on my NAS as well. On update of the files, run docker compose.
    <ul>
      <li>Pros: It works, probably. Seemingly simple to do as well?</li>
      <li>Cons: I don‚Äôt want to run a whole git server just for this. I don‚Äôt know how resource intensive it is, but I strive to have as little services running on my NAS as possible.</li>
    </ul>
  </li>
  <li>Have a periodically-run script invoke a <code class="language-plaintext highlighter-rouge">git pull</code> on my database (essentially polling)
    <ul>
      <li>Pros: Cron is lightweight, a git pull updating nothing probably doesn‚Äôt consume much system resources either.</li>
      <li>Cons: It won‚Äôt update immediately when I push to the database. I‚Äôd have to set a reasonable period to run the script. An hour? Day? Week?</li>
    </ul>
  </li>
</ul>

<p>Note that my perceptions on how intensive some of these processes are are an <em>intuition</em> and not well-researched fact.</p>

<p>Some other options I found through research</p>
<ul>
  <li>Watchtower. It‚Äôs an app that watches docker image versioning, and automatically updates running containers
    <ul>
      <li>I‚Äôd have to upload my images to a repository, then manage versioning. This probably means that I‚Äôd want to make a CI script that updates the version of the docker image on every push to the main branch (or manage versioning <em>manually</em>. blegh). For something that is probably (&lt;- I cannot say this is true), under the hood, running cron to trigger the container rebuilds, it is a lot of added overhead. I prefer my option 2 from above.</li>
    </ul>
  </li>
</ul>

<p>As I was researching more, I found a Reddit post containing this:</p>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/reddit.png" />
    <figcaption>thank you, venerable u/SUNx2YCH &amp; u/Angdrambor.</figcaption>
</figure>
<p>Validated by 2 strangers on a Reddit thread from 6 years ago. That‚Äôs all I ever needed. Option 2 it is.</p>

<h2 id="deploying-on-my-nas">Deploying on my NAS</h2>
<p>I created a very simple bash script that fulfilled my needs.</p>
<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">git rev-parse HEAD</code> to get current commit hash</li>
  <li>Run <code class="language-plaintext highlighter-rouge">git pull</code></li>
  <li>Run <code class="language-plaintext highlighter-rouge">git rev-parse HEAD</code> again</li>
  <li>See if the commit hash changed. If so, run <code class="language-plaintext highlighter-rouge">docker compose up</code></li>
</ol>

<p>I had everything I needed. But then in my shortsightedness I failed to realize that I can‚Äôt just SSH into the NAS, pull the code and <em>run docker compose</em>. TrueNAS scale uses kubernetes under the hood to manage containers, and the recommended way to do what I intend to do is to use a virtual machine! Or docker-in-docker. Sheesh. Virtualization much. If life is a simulation, it would be deployed on docker.</p>
<figure>
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/theory.png" style="width:70%" />
    <figcaption>there's a case to be made that "some guy" is living in a simulation too</figcaption>
</figure>

<p>I end up running docker in a VM. As I pull the code onto the machine, I realise that I needed to tweak some of the details in the deployment configs. And everytime after I make the tweak and pull the new commit on the machine, I realise that I need to tweak it some more! This happened 7 times! This is really a reminder that I should use a <code class="language-plaintext highlighter-rouge">deploy-testing</code> branch or something to make all my changes and testing there, and then squash the commits and merge into main when I was <em>truly</em> complete. I did this once and that commit history was <em>clean</em>, but in my hubris I thought I didn‚Äôt need to here.</p>
<figure style="margin-bottom:21px">
    <img class="blog-img" src="/blog/assets/blog-images/2024-pending/hubris.png" />
    <figcaption>hubris</figcaption>
</figure>

<p>I haven‚Äôt fully set it up on my home yet. To be ‚Äúdone‚Äù I want to add a domain name &amp; use https. I was messing with my router settings all the way from Germany (thousands of kilometers away from my home) on a VPN. When I remotely restarted the router, it shitted itself and died, leaving my family wondering what the hell happened. It took about an hour for me to walk through my family on how to fix it, so I think I‚Äôm done messing with it from HERE.</p>

<h1 id="show-off">Show off</h1>
<p>Now is the time I show bits and pieces of what all of this amounts to.</p>

<h2 id="ooo-infinite-scrolling">ooo infinite scrolling</h2>
<figure>
    <video class="blog-img" autoplay="" loop="" muted="" playsinline="" src="/blog/assets/blog-images/2024-pending/infinite.webm"></video>
    <figcaption>the invention of infinite scrolling and its consequences have been a disaster for the human race - tad kazynki</figcaption>
</figure>
<p>Infinite scrolling, baby. Starts loading of new content when reaching close to the bottom of the page, and seamlessly inserts it.</p>

<p><strong>Fact: nobody has ever done this before.</strong></p>

<h2 id="oooo-loading-animations">oooo loading animations</h2>
<figure>
    <video class="blog-img" autoplay="" loop="" muted="" playsinline="" src="/blog/assets/blog-images/2024-pending/loading.webm"></video>
    <figcaption>i call this: the skeleton loader. i added a delay to the app so that users can truly appreciate it.</figcaption>
</figure>
<p>Look at that loading animation. If that isn‚Äôt a loading animation, I don‚Äôt know what is. That is, without a doubt, one of the loading animations of all time.</p>

<p><strong>Fact: The <em>second</em> I pushed the code containing these loaders to github, Google called me with a job offer. I declined.</strong></p>

<h2 id="the-scrape-feature">The scrape feature</h2>
<figure>
    <video class="blog-img" autoplay="" loop="" muted="" playsinline="" src="/blog/assets/blog-images/2024-pending/scrape.webm"></video>
    <figcaption>the full article extraction in action</figcaption>
</figure>
<p>And the reason why I built this in the first place, full text extraction. It works!
By the way, I recorded this video on my laptop with my phone‚Äôs hotspot which had 1 bar on 4G which is why it loads so long. No, I will not speed up the video.</p>

<p><strong>Fact: Every important person in this world uses this app. <em>Are you important?</em></strong></p>

</article>

    </body>
</html>